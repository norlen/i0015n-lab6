name: Java CI with Maven

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'
        distribution: 'adopt'
    - name: Build with Maven
      run: mvn -B package --file pom.xml

  test:
    runs-on: ubuntu-latest
    container:
      image: openjdk:7
      options: --network-alias testhost
      env:
        TEST_URL: "http://testhost:4444"
    services:
      selenium-hub:
        image: selenium/hub:4.0.0-beta-3-prerelease-20210422
        container_name: selenium-hub
        ports:
          - 4442:4442
          - 4443:4443
          - 4444:4444
      chrome:
        image: selenium/node-chrome:4.0.0-beta-3-prerelease-20210422
        volumes:
          - /dev/shm:/dev/shm
        depends_on:
          - selenium-hub
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
        ports:
          - 6900:5900
      edge:
        image: selenium/node-edge:4.0.0-beta-3-prerelease-20210422
        volumes:
          - /dev/shm:/dev/shm
        depends_on:
          - selenium-hub
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
        ports:
          - 6901:5900
      firefox:
        image: selenium/node-firefox:4.0.0-beta-3-prerelease-20210422
        volumes:
          - /dev/shm:/dev/shm
        depends_on:
          - selenium-hub
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
        ports:
          - 6902:5900
      opera:
        image: selenium/node-opera:4.0.0-beta-3-prerelease-20210422
        volumes:
          - /dev/shm:/dev/shm
        depends_on:
          - selenium-hub
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
        ports:
          - 6903:5900
          
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'
        distribution: 'adopt'
    - name: Build with Maven
      run: mvn -B package --file pom.xml
